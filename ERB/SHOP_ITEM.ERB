@ITEM_BUY
	#DIM LOOP_CHR
	#DIM LOOP_ITEM
	#DIM ITEM_NO
	
	PRINTFORML {ITEMSALES:62}
	CALL ITEM_SALES
	PRINT_ITEM
	PRINTFORML 購入するアイテムを選んでください 所持金:${MONEY}
	CALL SHOW_ITEM
	PRINTL [100] - 戻る
	PRINT [200] - アイテムリセット
	$INPUT_LOOP
	INPUT
	ITEM_NO = RESULT
	IF RESULT == 100
		RETURN 0
	ELSEIF RESULT == 200
		LOCALS = アイテム個数をリセットしますか？
		CALL CHOICE(LOCALS, "はい", "いいえ")
		SIF RESULT
			RESTART
		FOR LOOP_ITEM, 0, 100
			ITEMSALES:LOOP_ITEM = 0
		NEXT
		RESTART
	ELSEIF ITEMSTOCK(RESULT) == 1 || ITEMSTOCK(RESULT) == 4 || RESULT < 0 || RESULT > 100
		RESTART
	ELSEIF ITEMSTOCK(RESULT) == 2
		PRINTW 売切です
		RESTART
	ELSEIF ITEMSTOCK(RESULT) == 3
		PRINTW 所持金が足りません
		RESTART
	ELSEIF ITEMSTOCK(RESULT) == 5
		PRINTW 既に十分持っています
		RESTART
	ENDIF
	;アイテムの説明
	DRAWLINE
	PRINTL
	PRINTFORML 〜%ITEMNAME:ITEM_NO%〜
	CALLFORM アイテム説明_{ITEM_NO}
	PRINTL
	DRAWLINE

	;個別に処理すべきもの
	IF ITEM_NO == 60 || ITEM_NO == 61 || ITEM_NO == 62
		LOCALS = %ITEMNAME:ITEM_NO%を習得しますか？
		CALL CHOICE(LOCALS, "はい", "いいえ")
		SIF RESULT
			RESTART
		MONEY -= ITEMPRICE:ITEM_NO
		SELECTCASE ITEM_NO
			CASE 60
				TALENT:MASTER:汚臭耐性 = 2
			CASE 61
				TALENT:MASTER:調合知識 = 1
			CASE 62
				TALENT:MASTER:禁断の知識 = 1
		ENDSELECT
		ITEMSALES:ITEM_NO = -1
		RESTART
	ENDIF
	IF ITEM_NO == 63
		CALL CHOICE("【技巧UP】を購入しますか？", "はい", "いいえ")
		SIF RESULT
			RESTART
		MONEY -= ITEMPRICE:ITEM_NO
		ABL:MASTER:技巧 += 1
		RESTART
	ENDIF
	IF ITEM_NO == 64
		CALL CHOICE("【技巧DOWN】を購入しますか？", "はい", "いいえ")
		SIF RESULT
			RESTART
		MONEY -= ITEMPRICE:ITEM_NO
		ABL:MASTER:技巧 -= 1
		RESTART
	ENDIF
	IF ITEM_NO == 70
		CALL CHOICE("【元気になる薬】を購入しますか？", "はい", "いいえ")
		SIF RESULT
			RESTART
		PRINTL 誰に使いますか？
		PRINTL [-1] - 戻る
		FOR LOOP_CHR, 0, CHARA_ACTIVE
			IF BASE:LOOP_CHR:0 < MAXBASE:LOOP_CHR:0
				PRINTFORM [{LOOP_CHR}] - %CALLNAME:(LOOP_CHR)% 
				CALL PRINT_BASE("体力",LOOP_CHR,0,32)
				PRINTL
			ENDIF
		NEXT
		$INPUT_LOOP_70
		INPUT
		IF RESULT == -1
			RESTART
		ELSEIF RESULT <= -1 || RESULT >= CHARA_ACTIVE || BASE:RESULT:0 == MAXBASE:RESULT:0
			GOTO INPUT_LOOP_70
		ELSE
			PRINTFORMW %CALLNAME:RESULT%の体力+300
			MONEY -= ITEMPRICE:ITEM_NO
			BASE:RESULT:0 += 300
			SIF BASE:RESULT:0 > MAXBASE:RESULT:0
				BASE:RESULT:0 = MAXBASE:RESULT:0
		ENDIF
		RESTART
	ENDIF
	IF ITEM_NO == 71
		CALL CHOICE("【薬の材料(双)】を購入しますか？", "はい", "いいえ")
		SIF RESULT
			RESTART
		PRINTL 誰に使いますか？
		PRINTL [-1] - 戻る
		FOR LOOP_CHR, 0, CHARA_ACTIVE
			SIF TALENT:LOOP_CHR:2 == 1
				PRINTFORML [{LOOP_CHR}] - %CALLNAME:(LOOP_CHR)% 
		NEXT
		$INPUT_LOOP_71
		INPUT
		IF RESULT == -1
			RESTART
		ELSEIF RESULT <= -1 || RESULT >= CHARA_ACTIVE || TALENT:RESULT:2 != 1
			GOTO INPUT_LOOP_71
		ELSE
			PRINTFORMW %CALLNAME:RESULT%はふたなりになりました
			MONEY -= ITEMPRICE:ITEM_NO
			TALENT:RESULT:2 |= 2
			MAXBASE:RESULT:射精 = 10000
			IF MAXBASE:RESULT:精力 > 0
				MAXBASE:RESULT:精力 = LIMIT(MAXBASE:RESULT:精力,200,1000)
			ELSE
				MAXBASE:RESULT:精力 = 1000
			ENDIF
			IF MAXBASE:RESULT:勃起 > 0
				MAXBASE:RESULT:勃起 = LIMIT(MAXBASE:RESULT:勃起,500,1500)
			ELSE
				MAXBASE:RESULT:勃起 = 1500
			ENDIF
		ENDIF
		RESTART
	ENDIF
	IF ITEM_NO == 72
		CALL CHOICE("【薬の材料(消)】を購入しますか？", "はい", "いいえ")
		SIF RESULT
			RESTART
		PRINTL 誰に使いますか？
		PRINTL [-1] - 戻る
		FOR LOOP_CHR, 0, CHARA_ACTIVE
			SIF TALENT:LOOP_CHR:2 == 3
				PRINTFORML [{LOOP_CHR}] - %CALLNAME:(LOOP_CHR)% 
		NEXT
		$INPUT_LOOP_72
		INPUT
		IF RESULT == -1
			RESTART
		ELSEIF RESULT <= -1 || RESULT >= CHARA_ACTIVE || TALENT:RESULT:2 != 3
			GOTO INPUT_LOOP_72
		ELSE
			PRINTFORMW %CALLNAME:RESULT%は女の子になりました
			MONEY -= ITEMPRICE:ITEM_NO
			TALENT:RESULT:2 = 1
			MAXBASE:RESULT:2 = 0
			MAXBASE:RESULT:精力 = 0
		ENDIF
		RESTART
	ENDIF
	IF ITEM_NO == 73
		CALL CHOICE("【青いキャンディ】を購入しますか？", "はい", "いいえ")
		SIF RESULT
			RESTART
		PRINTL 誰に使いますか？
		PRINTL [-1] - 戻る
		FOR LOOP_CHR, 0, CHARA_ACTIVE
			SIF !TALENT:LOOP_CHR:母乳体質 && HAS_VAGINA(LOOP_CHR)
				PRINTFORML [{LOOP_CHR}] - %CALLNAME:(LOOP_CHR)% 
		NEXT
		$INPUT_LOOP_73
		INPUT
		IF RESULT == -1
			RESTART
		ELSEIF RESULT <= -1 || RESULT >= CHARA_ACTIVE || TALENT:RESULT:149
			GOTO INPUT_LOOP_73
		ELSE
			PRINTFORMW %CALLNAME:RESULT%は[母乳体質]を得ました
			MONEY -= ITEMPRICE:ITEM_NO
			TALENT:RESULT:母乳体質 = 1
		ENDIF
		RESTART
	ENDIF
	IF ITEM_NO == 74
		CALL CHOICE("【赤いキャンディ】を購入しますか？", "はい", "いいえ")
		SIF RESULT
			RESTART
		PRINTL 誰に使いますか？
		PRINTL [-1] - 戻る
		FOR LOOP_CHR, 0, CHARA_ACTIVE
			SIF HAS_VAGINA(LOOP_CHR) && !TALENT:LOOP_CHR:処女
				PRINTFORML [{LOOP_CHR}] - %CALLNAME:(LOOP_CHR)% 
		NEXT
		$INPUT_LOOP_74
		INPUT
		IF RESULT == -1
			RESTART
		ELSEIF RESULT <= -1 || RESULT >= CHARA_ACTIVE || (TALENT:RESULT:処女 || !HAS_VAGINA(RESULT))
			GOTO INPUT_LOOP_74
		ELSE
			PRINTFORMW %CALLNAME:RESULT%の処女膜が再生しました
			MONEY -= ITEMPRICE:ITEM_NO
			TALENT:RESULT:処女 = 2
		ENDIF
		RESTART
	ENDIF
	IF ITEM_NO == 75
		CALL CHOICE("【豊胸剤】を購入しますか？", "はい", "いいえ")
		SIF RESULT
			RESTART
		PRINTL 誰に使いますか？
		PRINTL [-1] - 戻る
		FOR LOOP_CHR, 0, CHARA_ACTIVE
			SIF HAS_VAGINA(LOOP_CHR) && TALENT:LOOP_CHR:105 != 2
				PRINTFORML [{LOOP_CHR}] - %CALLNAME:(LOOP_CHR)% 
		NEXT
		$INPUT_LOOP_75
		INPUT
		IF RESULT == -1
			RESTART
		ELSEIF RESULT <= -1 || RESULT >= CHARA_ACTIVE || ((TALENT:RESULT:105 == 2) || !HAS_VAGINA(RESULT))
			GOTO INPUT_LOOP_75
		ELSE

			MONEY -= ITEMPRICE:ITEM_NO
			IF TALENT:RESULT:バストサイズ == 1
				PRINTFORMW %CALLNAME:RESULT%の胸は爆乳になった
				TALENT:RESULT:バストサイズ = 2
			ELSEIF TALENT:RESULT:バストサイズ == -1
				PRINTFORMW %CALLNAME:RESULT%の胸は普通程度の大きさになった
				TALENT:RESULT:バストサイズ = 0
			ELSEIF TALENT:RESULT:バストサイズ == -2
				PRINTFORMW %CALLNAME:RESULT%の胸は貧乳になった
				TALENT:RESULT:バストサイズ = -1
			ELSE
				PRINTFORMW %CALLNAME:RESULT%の胸は巨乳になった
				TALENT:RESULT:バストサイズ = 1
			ENDIF			
		ENDIF
		RESTART
	ENDIF
	IF ITEM_NO == 76
		CALL CHOICE("【縮胸剤】を購入しますか？", "はい", "いいえ")
		SIF RESULT
			RESTART
		PRINTL 誰に使いますか？
		PRINTL [-1] - 戻る
		FOR LOOP_CHR, 0, CHARA_ACTIVE
			SIF HAS_VAGINA(LOOP_CHR) && TALENT:LOOP_CHR:105 != -2
				PRINTFORML [{LOOP_CHR}] - %CALLNAME:(LOOP_CHR)% 
		NEXT
		$INPUT_LOOP_76
		INPUT
		IF RESULT == -1
			RESTART
		ELSEIF RESULT <= -1 || RESULT >= CHARA_ACTIVE || ((TALENT:RESULT:105 == -2) || !HAS_VAGINA(RESULT))
			GOTO INPUT_LOOP_76
		ELSE

			MONEY -= ITEMPRICE:ITEM_NO
			IF TALENT:RESULT:バストサイズ == 2
				PRINTFORMW %CALLNAME:RESULT%の胸は巨乳になった
				TALENT:RESULT:バストサイズ = 1
			ELSEIF TALENT:RESULT:バストサイズ == 1
				PRINTFORMW %CALLNAME:RESULT%の胸は普通程度の大きさになった
				TALENT:RESULT:バストサイズ = 0
			ELSEIF TALENT:RESULT:バストサイズ == -1
				PRINTFORMW %CALLNAME:RESULT%の胸は絶壁になった
				TALENT:RESULT:バストサイズ = -2
			ELSE
				PRINTFORMW %CALLNAME:RESULT%の胸は貧乳になった
				TALENT:RESULT:バストサイズ = -1
			ENDIF			
		ENDIF
		RESTART
	ENDIF
	IF ITEM_NO == 77
		CALL CHOICE("【橙色のキャンディ】を購入しますか？", "はい", "いいえ")
		SIF RESULT
			RESTART
		PRINTL 誰に使いますか？
		PRINTL (※強度が高いほど子宮が強化されます)
		PRINTL (※最大１０です)
		PRINTL [-1] - 戻る
		FOR LOOP_CHR, 0, CHARA_ACTIVE
			SIF GETBIT(TALENT:LOOP_CHR:性別,0)
			PRINTFORML [{LOOP_CHR}] - %CALLNAME:(LOOP_CHR)% (強度 {CFLAG:LOOP_CHR:多生児強度フラグ})
		NEXT
		$INPUT_LOOP_77
		INPUT
		IF RESULT == -1
			RESTART
		ELSEIF RESULT <= -1 || RESULT >= CHARA_ACTIVE || CFLAG:RESULT:多生児強度フラグ==10
			GOTO INPUT_LOOP_77
		ELSE
			CFLAG:RESULT:多生児強度フラグ++
			PRINTFORML %CALLNAME:RESULT%は橙色のキャンディを使用しました
			PRINTFORMW 現在の強度 {CFLAG:RESULT:多生児強度フラグ}
			MONEY -= ITEMPRICE:ITEM_NO
		ENDIF
		RESTART
		ENDIF
	IF ITEM_NO == 78
		CALL CHOICE("【抑プロラクチン薬】を購入しますか？", "はい", "いいえ")
		SIF RESULT
			RESTART
		PRINTL 誰に使いますか？
		PRINTL [-1] - 戻る
		FOR LOOP_CHR, 0, CHARA_ACTIVE
			SIF TALENT:LOOP_CHR:母乳体質 && HAS_VAGINA(LOOP_CHR)
				PRINTFORML [{LOOP_CHR}] - %CALLNAME:(LOOP_CHR)% 
		NEXT
		$INPUT_LOOP_78
		INPUT
		IF RESULT == -1
			RESTART
		ELSEIF RESULT <= -1 || RESULT >= CHARA_ACTIVE || (TALENT:RESULT:149 == 0)
			GOTO INPUT_LOOP_78
		ELSE
			PRINTFORMW %CALLNAME:RESULT%は[母乳体質]を失いました
			MONEY -= ITEMPRICE:ITEM_NO
			TALENT:RESULT:母乳体質 = 0
		ENDIF
		RESTART
	ENDIF
	IF ITEM_NO == 91
		CALL CHOICE("【排卵誘発剤】を購入しますか？", "はい", "いいえ")
		SIF RESULT
			RESTART
			PRINTL 誰に使いますか？
		FOR LOOP_CHR, 0, CHARA_ACTIVE
			SIF NO:(LOOP_CHR) == 501 && CFLAG:LOOP_CHR:75 < 3 && !TALENT:MASTER:禁断の知識
				CONTINUE
			SIF TALENT:LOOP_CHR:妊娠
				CONTINUE
			SIF GETBIT(TALENT:LOOP_CHR:2,0) && CFLAG:LOOP_CHR:81 != 3
				PRINTFORML [{LOOP_CHR}] - %CALLNAME:(LOOP_CHR)% 
		NEXT
		PRINTL [999] - 戻る
		$INPUT_LOOP_91
		INPUT
		IF RESULT == 999
			RESTART
		ELSEIF RESULT >= CHARA_ACTIVE || !GETBIT(TALENT:RESULT:2,0)
			GOTO INPUT_LOOP_91
		ELSE
			PRINTFORM %CALLNAME:RESULT%
			IF RESULT == 0
				PRINTW は排卵誘発剤を飲みました
			ELSE
				PRINTW に排卵誘発剤を渡しました
			ENDIF
			MONEY -= ITEMPRICE:ITEM_NO
			CFLAG:RESULT:81 = 2
			TRYCALL 排卵誘発剤追加処理, RESULT
		ENDIF
		RESTART
	ENDIF
	IF ITEM_NO == 92
		CALL CHOICE("【ピル】を購入しますか？", "はい", "いいえ")
		SIF RESULT
			RESTART
			PRINTL 誰に使いますか？
		FOR LOOP_CHR, 0, CHARA_ACTIVE
			SIF NO:(LOOP_CHR) == 501 && CFLAG:LOOP_CHR:75 < 3 && !TALENT:MASTER:禁断の知識
				CONTINUE
			SIF TALENT:LOOP_CHR:妊娠
				CONTINUE
			SIF GETBIT(TALENT:LOOP_CHR:2,0) && CFLAG:LOOP_CHR:81 != 3
				PRINTFORML [{LOOP_CHR}] - %CALLNAME:(LOOP_CHR)% 
		NEXT
		PRINTL [999] - 戻る
		$INPUT_LOOP_92
		INPUT
		IF RESULT == 999
			RESTART
		ELSEIF RESULT >= CHARA_ACTIVE || !GETBIT(TALENT:RESULT:2,0)
			GOTO INPUT_LOOP_92
		ELSE
			PRINTFORM %CALLNAME:RESULT%
			IF RESULT == 0
				PRINTW はピルを飲みました
			ELSE
				PRINTW にピルを渡しました
			ENDIF
			MONEY -= ITEMPRICE:ITEM_NO
			CFLAG:RESULT:81 = 3
		ENDIF
		RESTART
	ENDIF

	IF ITEM_NO == 93
		CALL CHOICE("【虹色のキャンディ】を購入しますか？", "はい", "いいえ")
		SIF RESULT
			RESTART
		PRINTL 誰に使いますか？
		PRINTL [-1] - 戻る
		FOR LOOP_CHR, 0, CHARA_ACTIVE
			SIF !TALENT:LOOP_CHR:恋慕
				PRINTFORML [{LOOP_CHR}] - %CALLNAME:(LOOP_CHR)% 
		NEXT
		$INPUT_LOOP_93
		INPUT
		IF RESULT == -1
			RESTART
		ELSEIF RESULT <= -1 || RESULT >= CHARA_ACTIVE || TALENT:RESULT:3
			GOTO INPUT_LOOP_93
		ELSE
			PRINTFORMW %CALLNAME:RESULT%は[恋慕]を得ました
			MONEY -= ITEMPRICE:ITEM_NO
			TALENT:RESULT:NTR = 0
			TALENT:RESULT:公衆便所 = 0
			TALENT:RESULT:浮気公認 = 0
			TALENT:RESULT:恋慕 = 1
		ENDIF
		RESTART
	ENDIF

	IF ITEM_NO == 94
		CALL CHOICE("【黒いキャンディ】を購入しますか？", "はい", "いいえ")
		SIF RESULT
			RESTART
		PRINTL 誰に使いますか？
		PRINTL [-1] - 戻る
		FOR LOOP_CHR, 0, CHARA_ACTIVE
			SIF !TALENT:LOOP_CHR:NTR
				PRINTFORML [{LOOP_CHR}] - %CALLNAME:(LOOP_CHR)% 
		NEXT
		$INPUT_LOOP_94
		INPUT
		IF RESULT == -1
			RESTART
		ELSEIF RESULT <= -1 || RESULT >= CHARA_ACTIVE || TALENT:RESULT:6
			GOTO INPUT_LOOP_94
		ELSE
			PRINTFORMW %CALLNAME:RESULT%は[NTR]を得ました
			MONEY -= ITEMPRICE:ITEM_NO
			TALENT:RESULT:恋慕 = 0
			TALENT:RESULT:人妻 = 0
			TALENT:RESULT:NTR = 1
		ENDIF
		RESTART
	ENDIF

	IF ITEM_NO == 95
		CALL CHOICE("【ダイヤモンド】を購入しますか？", "はい", "いいえ")
		SIF RESULT
			RESTART
		PRINTL 誰に使いますか？
		PRINTL [-1] - 戻る
		FOR LOOP_CHR, 0, CHARA_ACTIVE
			SIF CFLAG:LOOP_CHR:MASTERの弱味
				PRINTFORML [{LOOP_CHR}] - %CALLNAME:(LOOP_CHR)% 
		NEXT
		$INPUT_LOOP_95
		INPUT
		IF RESULT == -1
			RESTART
		ELSEIF RESULT <= -1 || RESULT >= CHARA_ACTIVE || TALENT:RESULT:6
			GOTO INPUT_LOOP_95
		ELSE
			PRINTFORMW %CALLNAME:RESULT%はあなたの弱みを解消しました
			MONEY -= ITEMPRICE:ITEM_NO
			CFLAG:RESULT:MASTERの弱味 = 0
		ENDIF
		RESTART
	ENDIF

	IF ITEM_NO == 96
		CALL CHOICE("【結婚指輪】を購入しますか？", "はい", "いいえ")
		SIF RESULT
			RESTART
		PRINTL 誰に使いますか？
		PRINTL [-1] - 戻る
		FOR LOOP_CHR, 1, CHARA_ACTIVE
			SIF (TALENT:LOOP_CHR:親愛||(TALENT:LOOP_CHR:恋慕&&CFLAG:LOOP_CHR:好感度>5000))&&TALENT:LOOP_CHR:人妻 == 0
				PRINTFORML [{LOOP_CHR}] - %CALLNAME:(LOOP_CHR)% 
		NEXT
		$INPUT_LOOP_96
		INPUT
		IF RESULT == -1
			RESTART
		ELSEIF RESULT <= -1 || RESULT >= CHARA_ACTIVE || TALENT:RESULT:6
			GOTO INPUT_LOOP_96
		ELSE
			PRINTFORMW %CALLNAME:RESULT%はあなたからの指輪を受け取り、妻となりました
			MONEY -= ITEMPRICE:ITEM_NO
			TALENT:RESULT:人妻 = 1
		ENDIF
		RESTART
	ENDIF

	IF ITEM_NO == 41
		MONEY -= ITEMPRICE:ITEM_NO
		ITEM:ITEM_NO ++
		PRINTW 媚薬を精製しました
		RESTART
	ENDIF
	;複数所持アイテム
	SELECTCASE ITEM_NO
		CASE 40 TO 60, 91, 92,
			PRINTFORM %ITEMNAME:ITEM_NO%をいくつ購入しますか？
			SIF ITEM_NO == 50
				PRINTFORM (あと{ITEMSALES:ITEM_NO}個)
			PRINTFORML 
			;金欠、アイテム数の超過はあとで合わせる
			PRINTL [0] - やめる
			PRINT [1] - 1　
			PRINT [5] - 5　
			PRINT [10] - 10　
			PRINT [20] - 20　
			PRINT [50] - 50　
			PRINT [999] - 買えるだけ
			INPUT
			SIF RESULT <= 0
				RESTART
			SIF RESULT * ITEMPRICE:ITEM_NO > MONEY
				RESULT = MONEY / ITEMPRICE:ITEM_NO
			;個数限定
			IF ITEMSALES:ITEM_NO
				IF RESULT >= ITEMSALES:ITEM_NO
					RESULT = ITEMSALES:ITEM_NO
					ITEMSALES:ITEM_NO = -1
				ELSE
					ITEMSALES:ITEM_NO -= RESULT
				ENDIF
			ELSE
				ITEM:ITEM_NO += RESULT
				IF ITEM:ITEM_NO > 999
					RESULT = 999 - (ITEM:ITEM_NO - RESULT)
					ITEM:ITEM_NO = 999
				ENDIF
			ENDIF
			PRINTFORMW %ITEMNAME:ITEM_NO%を{RESULT}個、${RESULT * ITEMPRICE:ITEM_NO}で購入しました
			MONEY -= RESULT * ITEMPRICE:ITEM_NO
			RESTART
	;単品アイテム
		CASE 0 TO 39
			PRINTFORML %ITEMNAME:ITEM_NO%を購入しますか？
			PRINTL [0] - はい  [1] - いいえ
			INPUT
			SIF RESULT
				RESTART
			ITEM:ITEM_NO ++
			ITEMSALES:ITEM_NO --
			MONEY -= ITEMPRICE:ITEM_NO
			RESTART
	ENDSELECT

@SHOW_ITEM
	#DIM LOOP_I
	#DIM ITEM_CNT
	
	DRAWLINE
	ITEM_CNT = 0
	FOR LOOP_I,0,100
		;表示しない
		SIF !SALLABLE_SHOP(LOOP_I, CFLAG:MASTER:現在位置)
			CONTINUE
		SIF ITEMSTOCK(LOOP_I) == 1
			CONTINUE
		SIF ITEMSTOCK(LOOP_I) == 4
			CONTINUE
		LOCALS = [{LOOP_I}]%ITEMNAME:(LOOP_I)% (${ITEMPRICE:(LOOP_I)})
		;売り切れ
		IF ITEMSTOCK(LOOP_I) == 2
			LOCALS = [{LOOP_I}]%ITEMNAME:LOOP_I% (売切)
			SETCOLOR 色設定_テキスト_無効
		ELSEIF ITEMSTOCK(LOOP_I) == 5
			LOCALS = [{LOOP_I}]%ITEMNAME:LOOP_I%
			SETCOLOR 色設定_テキスト_無効
		ENDIF
		PRINTFORM %LOCALS,28,LEFT%
		RESETCOLOR
		ITEM_CNT += 1
		SIF ITEM_CNT % 3 == 0
			PRINTL
	NEXT
	PRINTL

;条件付きアイテムの処理
@ITEM_SALES
	#DIM LOOP_I
	#DIM LOOP_CHR
	;ITEMSALES = 0 購入可
	;ITEMSALES = -1 売切
	;ITEMSALES = -2 封印
	;技巧
	IF ABL:MASTER:技巧 < 5
		ITEMSALES:63 = 0
	ELSE
		ITEMSALES:63 = -2
	ENDIF
	IF ABL:MASTER:技巧
		ITEMSALES:64 = 0
	ELSE
		ITEMSALES:64 = -2
	ENDIF

	SIF TALENT:MASTER:禁断の知識
		ITEMSALES:62 = -1
	SIF TALENT:MASTER:調合知識
		ITEMSALES:61 = -1
	SIF TALENT:MASTER:汚臭耐性 == 2
		ITEMSALES:60 = -1

	;結婚
	;SIF TALENT:MASTER:恋慕 || TALENT:MASTER:親愛
	;		ITEMSALES:96 =  0
	ITEMSALES:96 =  0

	;媚薬
	;精力剤
	IF ABL:MASTER:教養 < 1
		ITEMSALES:41 = -2
		ITEMSALES:精力剤 = -2
	ELSE
		IF ITEM:41
			ITEMSALES:41 = -1
		ELSE
			ITEMSALES:41 = 0
		ENDIF
		ITEMSALES:精力剤 = 0
	ENDIF

	;禁断
	FOR LOOP_I,70,96
		;売切の場合はそのまま
		SIF ITEMSALES:LOOP_I == -1
			CONTINUE
		ITEMSALES:LOOP_I = -2
		;禁断の知識
		IF (LOOP_I > 70 && LOOP_I < 89) || LOOP_I == 90 || LOOP_I == 95
			SIF TALENT:MASTER:禁断の知識 || (ASSI > 0 && TALENT:ASSI:禁断の知識)
				ITEMSALES:LOOP_I = 0
		;調合知識
		ELSEIF LOOP_I == 70 || LOOP_I == 91 || LOOP_I == 92 || LOOP_I == 93 || LOOP_I == 94
			SIF TALENT:MASTER:調合知識 || (ASSI > 0 && TALENT:ASSI:調合知識)
				ITEMSALES:LOOP_I = 0
		ENDIF
	NEXT

@SALLABLE_SHOP(ARG, ARG:1)
#FUNCTION
;ARG...アイテム番号
;ARG:1...現在位置
;現在位置に応じて売れるアイテムを1で返す。それ以外は0
SELECTCASE ARG:1
	CASE 場所_コンビニ
		SELECTCASE ARG
			CASE 41, 42, 45, 48
				RETURNF 1
		ENDSELECT
	CASE 場所_家電店
		SELECTCASE ARG
			CASE 19, 30, 35, 36, 44
				RETURNF 1
		ENDSELECT
	CASE 場所_雑貨屋
		SELECTCASE ARG
			CASE 41, 42, 45, 19, 35, 36, 44
				RETURNF 0
			CASEELSE
				RETURNF 1
		ENDSELECT
	CASEELSE
	;呼ばれることはないはずだけど一応
		RETURNF 0
ENDSELECT
RETURNF 0