
@SELECT_IDOL
#DIM Min_num
#DIM Max_num
#DIM C_chara
A=0

PRINTFORML キャラの選択方法をお選びください
PRINTFORML [ 0] - 自分で選ぶ
PRINTFORML [ 1] - ガチャ 特典:確定ＳＲ一人
INPUT
IF !INRANGE(RESULT,0,1)
	PRINTFORML 入力値が不正です。
	RESTART
ELSEIF RESULT == 0
	;一覧の初期表示
	Min_num = 1
	Max_num = 100
	C_chara = CHARA_ACTIVE
	$TOP
	PRINTL
	PRINTFORML あなたの事務所に所属する合計5人のアイドルを選びましょう！
	PRINTFORML 残り{5-A}人選択
	DRAWLINE
	LOCAL = 0
	;PRINTFORML {Min_num} {Max_num}
	PRINTFORM 現在表示
	IF Min_num==1
	SETCOLOR 0xff00ff
		PRINTFORML  キュート
	RESETCOLOR
	ELSEIF Min_num==101
	SETCOLOR 0x0088ff
		PRINTFORML  クール
	RESETCOLOR
	ELSEIF Min_num==201
	SETCOLOR 0xff8800
		PRINTFORML  パッション
	RESETCOLOR
	ELSEIF Min_num==301
	SETCOLOR 0x00ff00
		PRINTFORML  その他
	RESETCOLOR
	ENDIF
	FOR COUNT, Min_num, Max_num+1
		EXISTCSV COUNT
		IF RESULT==1 && (!GETBIT(FLAG:ゲームモード,1)||(GETCHARA(COUNT)==-1&&COUNT!=351))
			LOCALS'=CSVNAME(COUNT)
			PRINTFORM [{COUNT}] %LOCALS%　
			LOCAL ++
			;１行５人表示
			IF LOCAL % 5 == 0
				PRINTL
			ENDIF
		ENDIF
	NEXT
	;一覧の上限を固定
	FOR COUNT, 0, (100/5)-(LOCAL / 5)
	NEXT
	PRINTL
	PRINTL
	DRAWLINE
	PRINTL 選んだアイドル
	FOR COUNT, 0, A
		SIF !GETBIT(FLAG:ゲームモード,1)
			PRINTFORM 　[{NO:(C_chara+COUNT)}]
		PRINTFORM  %NAME:(C_chara+COUNT)%　
	NEXT
	PRINTL
	PRINTL
	DRAWLINE
	PRINT [-1] 前のページ　
	PRINTL [-2] 次のページ
	PRINTL
	INPUT
	
	IF RESULT == -1
		IF Min_num-100 < 1
			Min_num = 1
			Max_num = 100
		ELSE
			IF Max_num == CSVキャラ数
				Max_num = Min_num
			ELSE
				Max_num = Max_num-100
			ENDIF
			Min_num = Min_num-100
		ENDIF
	ELSEIF RESULT == -2
		IF Min_num+100 >= CSVキャラ数
			Min_num = Min_num
			Max_num = Max_num
		ELSE
			Min_num = Min_num+100
			Max_num = Max_num+100
		ENDIF
	ELSEIF INRANGE(RESULT,1,CSVキャラ数) && (!GETBIT(FLAG:ゲームモード,1)||(GETCHARA(RESULT)==-1&&RESULT!=351))
		ADDCHARA RESULT
		A=A+1
	ELSE
	PRINTFORML 入力値が不正です。
	ENDIF
	SIF A<5
		GOTO TOP
	
	;選んだキャラの最終確認
	PRINTL
	FOR COUNT,0,5
		PRINTFORML  %NAME:(COUNT+1)%
	NEXT
	PRINTL
	PRINTFORML この５人でいいですか？
	PRINTFORML [ 0] - ＯＫ
	PRINTFORML [ 1] - 選びなおす
	INPUT
	IF RESULT!=0 
		A = 0
		DELCHARA 1
		DELCHARA 1
		DELCHARA 1
		DELCHARA 1
		DELCHARA 1
		GOTO TOP
	ENDIF
	
ELSE
$TOP_G
	PRINTFORML %CALLNAME:MASTER%の事務所に…
	FOR COUNT,0,5
		LOCAL:COUNT=ガチャ(0)
		LOCALS:COUNT=%CSVNAME(LOCAL:COUNT)%
		IF COUNT==0
			PRINTFORM [ＳＲ]
		ELSE
			PRINTFORM  　　 
		ENDIF
		PRINTFORML  %LOCALS:COUNT%
		ADDCHARA LOCAL:COUNT
	NEXT
	PRINTFORML の五人が応募してきた。
	PRINTFORML [ 0] - ＯＫ
	PRINTFORML [ 1] - 引き直し
INPUT
	IF RESULT!=0 
		DELCHARA 1
		DELCHARA 1
		DELCHARA 1
		DELCHARA 1
		DELCHARA 1
		GOTO TOP_G
	ENDIF
	SETBIT TALENT:1:ＳＲ, RAND:2

ENDIF

VARSET CFLAG:MASTER, 0
CFLAG:0:311=場所_あなたの家
CFLAG:0:300=CFLAG:0:311
;素質の変換および初期値セットアップ
FOR COUNT,1,6
	CALL 素質の変換(COUNT)
NEXT

@IDOLRANK(ARG)
;INPUT(0-9に対してアルファベットを返す)
#FUNCTIONS
SELECTCASE ARG
	CASE 0
		RETURNF "Ｆ"
	CASE 1
		RETURNF "Ｅ"
	CASE 2
		RETURNF "Ｄ"
	CASE 3
		RETURNF "C-"
	CASE 4
		RETURNF "C+"
	CASE 5
		RETURNF "B-"
	CASE 6
		RETURNF "B+"
	CASE 7
		RETURNF "A-"
	CASE 8
		RETURNF "A+"
	CASE 9
		RETURNF "Ｓ"
	CASEELSE
		RETURNF "アイドルランクエラー"
ENDSELECT

@IDOLSTATAS(ARG)
;ARGのアイドル技能表示
	PRINTFORM Vi{ABL:ARG:ビジュアル技能,2,LEFT}/
	PRINTFORM Vo{ABL:ARG:ボーカル技能,2,LEFT}/
	PRINTFORM Da{ABL:ARG:ダンス技能,2,LEFT}

@MAKE_AUDITION(ARG)
#DIM C_COUNT
;ARG0~9で生成
;初期化
FOR C_COUNT ,0, 4
	ランク:ARG:C_COUNT=0
NEXT
FOR C_COUNT,0, (ARG+ARG/4)*3+1
	ランク:ARG:(RAND:3)++
NEXT

@AUDITION_STATE(ARG)
;ランクARGの情報開示
#FUNCTIONS


;LOCALに最も重い比重を配置
IF ランク:ARG:0 > ランク:ARG:1 && ランク:ARG:0 > ランク:ARG:2
	LOCAL=0
ELSEIF ランク:ARG:1 > ランク:ARG:2
	LOCAL=1
ELSE
	LOCAL=2
ENDIF

;個々に判別する方
;IF ランク:ARG:3==0
IF 0
	RETURNF AUDITION_KAMOKU(LOCAL)+"能力（"+TOSTR(ランク:ARG:LOCAL)+"）を筆頭に、個々の要素毎に評価：目標総能力値="+TOSTR(ランク:ARG:0+ランク:ARG:1+ランク:ARG:2)
ELSE
	RETURNF AUDITION_KAMOKU(LOCAL)+"能力に比重が置かれた総合能力で評価:目標総能力値="+TOSTR(ランク:ARG:0+ランク:ARG:1+ランク:ARG:2)
;総合的に判断
ENDIF


@AUDITION_KAMOKU(ARG)
;ARG文字列をリターンする
#FUNCTIONS
SELECTCASE ARG
	CASE 0
		RETURNF "ビジュアル"
	CASE 1
		RETURNF "ボーカル"
	CASE 2
		RETURNF "ダンス"
	CASEELSE
		RETURNF "エラー"
ENDSELECT

@素質の変換(ARG)
CSTR:ARG:フルネーム=%NAME:ARG%
CSTR:ARG:呼び名=%CALLNAME:ARG%
CSTR:ARG:源氏名=%GENJINA(ARG)%
IF TALENT:ARG:ＥＮＥＭＹ
	CFLAG:ARG:311=場所_間男長屋
ELSE
	CFLAG:ARG:311=場所_アイドル長屋
ENDIF
CFLAG:ARG:現在位置 = CFLAG:ARG:311
CFLAG:ARG:300=CFLAG:ARG:311
CFLAG:ARG:口上パターン=NO:ARG
CFLAG:ARG:298=1;行動ぱたーぬ
CFLAG:ARG:360=1
CFLAG:ARG:7=2
;活動開始日
CFLAG:ARG:活動開始日=DAY

;念のため掃除
CFLAG:ARG:16=0
CFLAG:ARG:19=0
CFLAG:ARG:21=0
CFLAG:ARG:22=0
CFLAG:ARG:23=0
CFLAG:ARG:24=0
CFLAG:ARG:25=0
CFLAG:ARG:41=0
ABL:ARG:交渉能力=RAND:3
;誕生日の移植
BASE:ARG:14=BASE:ARG:11
BASE:ARG:15=BASE:ARG:12

MAXBASE:ARG:10=1500
MAXBASE:ARG:11=1000
MAXBASE:ARG:12=1000
MAXBASE:ARG:13=1000

BASE:ARG:10=0
BASE:ARG:11=000
BASE:ARG:12=000
BASE:ARG:13=000

IF GETBIT(TALENT:ARG:ＳＲ,0)
	FOR COUNT:1, 0 ,300
		SELECTCASE RAND:3
			CASE 0
				EXP:ARG:ビジュアル経験++
			CASE 1
				EXP:ARG:ボーカル経験++
			CASE 2
				EXP:ARG:ダンス経験++
		ENDSELECT
	NEXT
ENDIF
;念のため処女チェック
;オトコ
IF TALENT:ARG:1122==1 || TALENT:ARG:2==2
TALENT:ARG:2=2
TALENT:ARG:1122=0
ELSE
TALENT:ARG:2=1
ENDIF
SIF TALENT:ARG:2==1& EXP:ARG:1==0
TALENT:ARG:0=1

;臆病
IF TALENT:ARG:1010==1
TALENT:ARG:10=-1
TALENT:ARG:1010=0
ENDIF
;反抗的
IF TALENT:ARG:1011==1
TALENT:ARG:11=1
TALENT:ARG:1011=0
ENDIF
;気丈
IF TALENT:ARG:1012==1
TALENT:ARG:10=1
TALENT:ARG:1012=0
ENDIF
;素直
IF TALENT:ARG:1013==1
TALENT:ARG:11=-1
TALENT:ARG:1013=0
ENDIF
;おとなしい
IF TALENT:ARG:1014==1
TALENT:ARG:12=-1
TALENT:ARG:1014=0
ENDIF
;プライド高い
IF TALENT:ARG:1015==1
TALENT:ARG:13=1
TALENT:ARG:1015=0
ENDIF
;生意気
IF TALENT:ARG:1016==1
TALENT:ARG:12=1
TALENT:ARG:1016=0
ENDIF
;プライド低い
IF TALENT:ARG:1017==1
TALENT:ARG:13=-1
TALENT:ARG:1017=0
ENDIF
;好奇心
IF TALENT:ARG:1023==1
TALENT:ARG:23=1
TALENT:ARG:1023=0
ENDIF
;保守的
IF TALENT:ARG:1024==1
TALENT:ARG:23=-1
TALENT:ARG:1024=0
ENDIF
;楽観的
IF TALENT:ARG:1025==1
TALENT:ARG:24=1
TALENT:ARG:1025=0
ENDIF
;悲観的
IF TALENT:ARG:1026==1
TALENT:ARG:24=-1
TALENT:ARG:1026=0
ENDIF
;貞操観念
IF TALENT:ARG:1030==1
TALENT:ARG:30=1
TALENT:ARG:1030=0
ENDIF
;貞操無頓着
IF TALENT:ARG:1031==1
TALENT:ARG:30=-1
TALENT:ARG:1031=0
ENDIF
;抑圧
IF TALENT:ARG:1032==1
TALENT:ARG:31=-1
TALENT:ARG:1032=0
ENDIF
;開放
IF TALENT:ARG:1033==1
TALENT:ARG:31=1
TALENT:ARG:1033=0
ENDIF
;恥じらい
IF TALENT:ARG:1035==1
TALENT:ARG:33=1
TALENT:ARG:1035=0
ENDIF
;恥薄い
IF TALENT:ARG:1036==1
TALENT:ARG:33=-1
TALENT:ARG:1036=0
ENDIF
;痛みに弱い
IF TALENT:ARG:1040==1
TALENT:ARG:40=1
TALENT:ARG:1040=0
ENDIF
;痛みに強い
IF TALENT:ARG:1041==1
TALENT:ARG:40=-1
TALENT:ARG:1041=0
ENDIF
;濡れやすい
IF TALENT:ARG:1042==1
TALENT:ARG:41=1
TALENT:ARG:1042=0
ENDIF
;濡れにくい
IF TALENT:ARG:1043==1
TALENT:ARG:41=-1
TALENT:ARG:1043=0
ENDIF
;習得はやい
IF TALENT:ARG:1050==1
TALENT:ARG:50=1
TALENT:ARG:1050=0
ENDIF
;習得遅い
IF TALENT:ARG:1051==1
TALENT:ARG:50=-1
TALENT:ARG:1051=0
ENDIF
;汚臭鈍感
IF TALENT:ARG:1061==1
TALENT:ARG:61=1
TALENT:ARG:1061=0
ENDIF
;汚臭敏感
IF TALENT:ARG:1062==1
TALENT:ARG:61=-1
TALENT:ARG:1062=0
ENDIF
;汚れ無視
IF TALENT:ARG:1064==1
TALENT:ARG:61=2
TALENT:ARG:1064=0
ENDIF
;快感に素直
IF TALENT:ARG:1070==1
TALENT:ARG:70=1
TALENT:ARG:1070=0
ENDIF
;快感の否定
IF TALENT:ARG:1071==1
TALENT:ARG:70=-1
TALENT:ARG:1071=0
ENDIF
;男勝り
IF TALENT:ARG:1079==1
TALENT:ARG:81=2
TALENT:ARG:1079=0
ENDIF
;両刀
IF TALENT:ARG:1081==1
TALENT:ARG:81=-1
TALENT:ARG:1081=0
ENDIF
;男嫌い
IF TALENT:ARG:1082==1
TALENT:ARG:81=1
TALENT:ARG:1082=0
ENDIF
;長身
IF TALENT:ARG:1099==1
TALENT:ARG:100=1
TALENT:ARG:1099=0
ENDIF
;小柄体形
IF TALENT:ARG:1100==1
TALENT:ARG:100=-1
TALENT:ARG:1100=0
ENDIF
;C鈍
IF TALENT:ARG:1101==1
TALENT:ARG:101=-1
TALENT:ARG:1101=0
ENDIF
;C敏
IF TALENT:ARG:1102==1
TALENT:ARG:101=1
TALENT:ARG:1102=0
ENDIF
;V鈍
IF TALENT:ARG:1103==1
TALENT:ARG:102=-1
TALENT:ARG:1103=0
ENDIF
;V敏
IF TALENT:ARG:1104==1
TALENT:ARG:102=1
TALENT:ARG:1104=0
ENDIF
;A鈍
IF TALENT:ARG:1105==1
TALENT:ARG:103=-1
TALENT:ARG:1105=0
ENDIF
;A敏
IF TALENT:ARG:1106==1
TALENT:ARG:103=1
TALENT:ARG:1106=0
ENDIF
;B鈍
IF TALENT:ARG:1107==1
TALENT:ARG:104=-1
TALENT:ARG:1107=0
ENDIF
;B敏
IF TALENT:ARG:1108==1
TALENT:ARG:104=1
TALENT:ARG:1108=0
ENDIF
;貧乳
IF TALENT:ARG:1109==1
TALENT:ARG:105=-1
TALENT:ARG:1109=0
ENDIF
;巨乳
IF TALENT:ARG:1110==1
TALENT:ARG:105=1
TALENT:ARG:1110=0
ENDIF
;回復早い
IF TALENT:ARG:1111==1
TALENT:ARG:130=1
TALENT:ARG:1111=0
ENDIF
;回復遅い
IF TALENT:ARG:1112==1
TALENT:ARG:130=-1
TALENT:ARG:1112=0
ENDIF
;縛乳
IF TALENT:ARG:1114==1
TALENT:ARG:105=2
TALENT:ARG:1114=0
ENDIF
;絶壁
IF TALENT:ARG:1116==1
TALENT:ARG:105=-2
TALENT:ARG:1116=0
ENDIF

@ガチャ(ARG)
;キャラのNOを返す

#FUNCTION
LOCAL=RAND:CSVキャラ数

;例外処理;あなた
SIF LOCAL==0
	RESTART
;例外処理;CSVが存在しない(ないと思うけど念のため)
EXISTCSV LOCAL
SIF !RESULT
	RESTART
;既存のキャラとのかぶりの防止
IF GETBIT(FLAG:ゲームモード,1)
	FOR COUNT:1,0, CHARA_ACTIVE
		SIF NO:(COUNT:1)==LOCAL
			RESTART
	NEXT
	FOR COUNT:1,0, 1000
		SIF LOCAL==履歴_NO:(COUNT:1)
			RESTART
	NEXT
ENDIF
RETURNF LOCAL

@履歴MAKING(ARG,ARG:1)
;登録番号ARGのキャラに関する履歴を読み取る
;ARG:1,内容

	
	履歴_NO:履歴_IX=NO:ARG
	履歴_DAY:履歴_IX:0=CFLAG:ARG:活動開始日
	履歴_DAY:履歴_IX:1=DAY
	履歴_CO:履歴_IX:0=CFLAG:ARG:アイドルランク
	履歴_CO:履歴_IX:1=ARG:1
履歴_IX++
RETURN 1
;-------------------------------------------------------------------------------
;表示できるか評価する。CAN_MOVE、同じ場所、FLAG:訪問者との汚れ判定に使用の32bit目で評価。
;ARG…口上元の発生場所
;戻り値…1:条件成立 0:条件非成立
;仮

@CHK_VISIBLE(ARG)
	#FUNCTION
	
	IF IS_NTR_SHOW_ALL()
		RETURNF 1
	ENDIF
	IF CFLAG:MASTER:現在位置 == ARG
		RETURNF 1
	ENDIF
	IF CAN_MOVE(CFLAG:MASTER:現在位置, ARG) == 2
		RETURNF 1
	ENDIF
RETURNF 0

@真名隠蔽(ARG)
;ARGの名前を隠す
NAME:ARG=？？？
CALLNAME:ARG=？？？
CFLAG:ARG:名前フラグ=0

@真名看破(ARG)
;上の逆
NAME:ARG=%CSTR:ARG:フルネーム%
CALLNAME:ARG=%CSTR:ARG:呼び名%
CFLAG:ARG:名前フラグ=1

@所属(ARG)
#FUNCTION
;ARGの所属が事務所だったら1を返す
SIF TALENT:ARG:事務員
	RETURNF 1
;あなただったら1を返す
SIF ARG==MASTER
	RETURNF 1
;アイドルかトレーナーぽいなら1を返す
;同棲中の子も所属していると見られるのであなたの家は除外する（暫定）
SIF 場所_あなたの家 <= CFLAG:ARG:開始位置 && CFLAG:ARG:開始位置 <= 場所番号最大値 && CFLAG:ARG:開始位置 != 場所_あなたの家
	RETURNF 1
RETURNF 0

@能力表示許可(ARG)
;将来的にoptionとかで拡張する予定
#FUNCTION
#DIM TEMP
;SIF 所属(ARG) || CFLAG:MASTER:現在位置==CFLAG:ARG:現在位置 || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:ARG:現在位置)==2
SIF (所属(ARG) || TALENT:ARG:恋慕) && (GETBIT(FLAG:ＮＴＲパッチ設定,32) || CFLAG:MASTER:現在位置==CFLAG:ARG:現在位置 || CAN_MOVE(CFLAG:MASTER:現在位置, CFLAG:ARG:現在位置)==2)
	RETURNF 1
RETURNF 0

@ラブホ_移動処理(ARG)
CFLAG:ARG:現在位置= 場所_ラブホあなた用
CFLAG:MASTER:現在位置= 場所_ラブホあなた用
;服対策でここで前ターン偽造
CFLAG:ARG:前ターン位置=場所_ラブホあなた用
;CALL CLOTHES_Preset_NUDE(ARG)
CFLAG:ARG:うふふ=1

@GET_SEC()
#FUNCTION
;事務員の番号を返す
#DIM LOOP_CHR
FOR LOOP_CHR,1, CHARA_ACTIVE
	SIF TALENT:LOOP_CHR:事務員
		RETURNF LOOP_CHR
NEXT

@名前色決め(ARG)
;番号に応じた色にする
	IF ARG <101
		SETCOLOR 0xff00ff
	ELSEIF ARG < 201
		SETCOLOR 0x0088ff
	ELSEIF ARG < 301
		SETCOLOR 0xff8800
	ELSE
		SETCOLOR 0x00ff00
	ENDIF